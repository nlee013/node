
var mongoose = require("mongoose");

//database 객체에 db, schema, model 추가
var database = {};

//app=express 객체
//config = config.js 정보
database.init = function(app, config) {
	
	connect(app, config);
	
}

function connect(app, config){
	
	console.log("connect 호출된다..")
	
	mongoose.connect(config.dbUrl);//databaseUrl->config.dbUrl
	
	database = mongoose.connection;
	
	database.on("open",function(){
		
		console.log("데이터베이스가 연결되었습니다: " + config.dbUrl);
		
		//config에 등록된 스키마,모델 객체 생성
		createUserSchema(app, config);//userSchema.js의 createUserSchema()
		
	});
	
	database.on("error",console.error.bind(console,"몽구스 연결 에러..."));
	
	database.on("disconnected",function(){
		
		console.log("DB연결이 끊겼습니다 5초후 재연결 합니다");
		setInterval(connectDB(),5000);
	});
	
}

//config에 정의된 schema 및 모델 객체 생성
function createSchema(app, config){
	
	var schemaLen = config.dbSchemas.length;
	
	
}